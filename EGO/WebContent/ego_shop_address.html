<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
  <title>ego易购商城收货地址</title>

  <!-- Bootstrap -->
  <link href="css/bootstrap.css" rel="stylesheet">
  <link href="css/offcanvas.min.css" rel="stylesheet">
  <link href="css/header.css" rel="stylesheet">
  <link href="css/foot.css" rel="stylesheet">
  <!--[if lt IE 9]>
      <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
    <![endif]-->
  <link rel="stylesheet" href="css/ego_shop_address.css" type="text/css">
</head>

<body>
  <div class="overlay"></div>
  <!-- 页头 -->
  <div class="navbar navbar-default page_header" style="margin: 0;background-color: white;padding-top: 10px;">
    <div class="container">

      <div class="navbar-header logo">
        <!-- 头部：LOGO -->
        <a href="index.html"><img src="pic/index/logo.png" alt=""></a>
      </div>

      <!-- 右侧链接和文字 -->
      <span style="display: none;" class="navbar-text  navbar-link navbar-right" id="nickname">&nbsp;&nbsp;<a
          id="logout" href="#">退出</a></span>
      <a style="display: none;" id="login" class="navbar-text  navbar-link navbar-right"
        href="ego_shop_login.html">登录</a>
      <span class="navbar-text navbar-right">|</span>
      <a style="display: none;" id="regist" class="navbar-text  navbar-link navbar-right"
        href="ego_shop_register.html">注册</a>
      <a style="display: none;" id="personal" class="navbar-text  navbar-link navbar-right"
        href="ego_shop_personal.html">个人中心</a>
      <span class="navbar-text navbar-right">|</span>
      <a class="navbar-text navbar-link navbar-right" href="#" data-target="#myModal2" id="cart1">
        <span class="glyphicon glyphicon-shopping-cart"></span>
      </a>
      <span class="navbar-text navbar-right">|</span>
      <a class="navbar-text navbar-link navbar-right" href="#">
        <span class="glyphicon glyphicon-heart"></span>
      </a>

      <!-- 搜索表单 -->
      <form action="#" class="navbar-form navbar-right md_search_fm">
        <div class="input-group">
          <input id="md_keyword" type="text" placeholder="请输入关键词" class="form-control">
          <span class="input-group-btn">
            <button id="md_search" type="button" class="btn bg-primary">
              <span class="glyphicon glyphicon-search"></span>
            </button>
          </span>
        </div>
      </form>
    </div>
  </div>


  <!--导航条-->
  <div class="navbar navbar-inverse navbar-static-top" style="border-radius: 0;padding: 0;margin: 0;">
    <div class="container">
      <div class="navbar-header">
        <!-- 头部：汉堡包按钮 -->
        <button type="button" class="navbar-toggle pull-left collapsed" data-toggle="offcanvas" data-target="#egoMenu">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <!-- 登录注册下拉菜单 -->
        <div class="dropdown">
          <button type="button" class="navbar-toggle pull-right dropdown-toggle" style="color: white;"
            data-toggle="dropdown">
            <span class="glyphicon glyphicon-user"></span>
          </button>
          <ul class="dropdown-menu pull-right" role="menu" aria-labelledby="dropdownMenu1"
            style="background-color: black;height: 160px;text-align: center;">
            <li role="presentation">
              <a role="menuitem" tabindex="-1" href="ego_shop_login.html" style="font-size: 13px; color: white;">登录</a>
            </li>
            <li role="presentation">
              <a role="menuitem" tabindex="-1" href="ego_shop_register.html"
                style="font-size: 13px; color: white;">注册</a>
            </li>
            <li role="presentation">
              <a role="menuitem" tabindex="-1" href="#" style="font-size: 13px; color: white;" data-target="#myModal"
                id="cart2">
                <span class="glyphicon glyphicon-shopping-cart"></span>
              </a>
            </li>
            <li role="presentation">
              <a role="menuitem" tabindex="-1" href="#" style="font-size: 13px; color: white;">
                <span class="glyphicon glyphicon-heart"></span>
              </a>
            </li>



          </ul>
        </div>
      </div>
      <!-- 导航条折叠部分 -->
      <div class="collapse navbar-collapse sidebar-offcanvas" id="egoMenu">
        <!-- 折叠部分：左侧的菜单 -->
        <ul class="nav navbar-nav">
          <li><a href="index.html">首页</a></li>
          <li><a href="productList.html?aspect=jianshenfuzhuang" id="jianshenfuzhuang">健身服装</a></li>
          <li><a href="productList.html?aspect=jianshenhuju" id="jianshenhuju">健身护具</a></li>
          <li><a href="productList.html?aspect=jianshenqicai" id="jianshenqicai">健身器材</a></li>
          <li><a href="productList.html?aspect=jianshenshipin" id="jianshenshipin">健身食品</a></li>
          <li><a href="productList.html?aspect=yundongxie" id="yundongxie">运动鞋</a></li>
        </ul>
      </div>
    </div>
  </div>

  <!-- 模态框（Modal） -->
  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
            &times;
          </button>
          <h4 class="modal-title" id="myModalLabel">
            请登录
          </h4>
        </div>
        <div class="modal-body">
          您尚未登录！请登录后查看
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">关闭
          </button>
          <a href="ego_shop_login.html">
            <button type="button" class="btn btn-primary">
              登录
            </button>
          </a>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal -->
  </div>

  <!--主体-->
  <div class="container">
    <div class="col-md-2 mybackground">
      <h3 class="text-center hidden-xs hidden-sm">个人信息</h3>
      <p class="hidden-xs hidden-sm">&nbsp;</p>
      <div class="btn-group-vertical center-block hidden-xs hidden-sm" role="group" aria-label="mylabel">
        <button type="button" class="btn btn-default" id="ego_personal">基本信息</button>
        <button type="button" class="btn btn-default" id="ego_address">收货地址</button>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
      </div>
    </div>

    <div class="col-md-10">
      <div class="mybackground">
        <h3 class="text-center hidden-sm hidden-lg">收货地址</h3>
        <p class="hidden-md hidden-lg">&nbsp;</p>
        <p class="hidden-xs hidden-sm">&nbsp;</p>
        <p class="hidden-xs hidden-sm">&nbsp;</p>
        <p class="hidden-xs hidden-sm">&nbsp;</p>
        <div class="container">
          <div class="row">
            <button type="button" class="btn-mine col-md-2" id="make_addModal">新增收货地址</button>
            &nbsp;<a role="menuitem" tabindex="-1" href="ditu1.html" style="font-size: 30px; color: white;">
              					<img alt="" src="pic/you.png" style="width:30px;height:30px"><img alt="" src="pic/ditu.png" style="width:30px;height:30px">
              				</a>
             您已选择的收货地址是：<input id="dizhi" type="text" placeholder="还没有地址" class="" value="">			
             
          </div>
          

          <div id="waitingInsert">

          </div>

        </div>

        <div class="modal fade" id="addressModal">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                    aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">添加收货地址</h4>
              </div>
              <div class="modal-body">
                <form class="form-horizontal">
                  <div class="form-group">
                    <label class="col-xs-12 col-md-2 control-label">收货人</label>
                    <div class="col-md-3">
                      <input class="form-control" id="add_receiver" type="text" placeholder="">
                    </div>
                  </div>
                  <div class="form-group">
                    <label class="col-xs-12 col-md-2 control-label">收货地区</label>
                    <div class="col-xs-12 col-md-10">
                      <div class="row">
                        <div class="col-md-3">
                          <input class="form-control" id="add_province" type="text" placeholder="------省------">
                        </div>
                        <div class="col-md-3">
                          <input class="form-control" id="add_city" type="text" placeholder="------市------">
                        </div>
                        <div class="col-md-3">
                          <input class="form-control" id="add_county" type="text" placeholder="------区------">
                        </div>
                        <div class="col-md-12 form-group">&nbsp;</div>
                        
                      </div>
                    </div>
                  </div>
                  <div class="form-group has-feedback" id="phoneTrue">
                    <label class="col-md-2 control-label">联系电话</label>
                    <div class="col-md-4 phoneTrue">
                      <input class="form-control wronginputPH" id="add_phone" type="text" placeholder="">
                      <span id="phoneSpan" class="glyphicon form-control-feedback" aria-hidden="true"></span>
                    </div>
                  </div>
                  <div class="form-group has-feedback" id="postcodeTrue">
                    <label class="col-md-2 control-label">邮政编码</label>
                    <div class="col-md-4" id="postcodeTrue">
                      <input class="form-control wronginputPH" id="add_postcode" type="text" placeholder="">
                      <span id="postcodeSpan" class="glyphicon form-control-feedback" aria-hidden="true"></span>
                    </div>
                  </div>
                </form>
              </div>

              <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal" id="closeModal">关闭</button>
                <button type="button" class="btn btn-primary" id="saveAddress">保存</button>
              </div>
            </div>
          </div>
        </div>

        <div class="modal fade" id="editModal">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                    aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="EditModalLabel">编辑收货地址</h4>
              </div>
              <div class="modal-body">
                <form class="form-horizontal">
                  <div class="form-group">
                    <label class="col-md-2 control-label">收货人</label>
                    <div class="col-md-3">
                      <input class="form-control" id="edit_receiver" type="text" placeholder="">
                    </div>
                  </div>
                  <div class="form-group">
                    <label class="col-md-2 control-label">收货地区</label>
                    <div class="col-md-10">
                      <div class="row">
                        <div class="col-md-3">
                          <input class="form-control" id="edit_province" type="text" placeholder="------省------">
                        </div>
                        <div class="col-md-3">
                          <input class="form-control" id="edit_city" type="text" placeholder="------市------">
                        </div>
                        <div class="col-md-3">
                          <input class="form-control" id="edit_county" type="text" placeholder="------区------">
                        </div>
                        <div class="col-md-12">&nbsp;</div>
                        
                      </div>
                    </div>
                  </div>
                  <div class="form-group has-feedback" id="EditphoneTrue">
                    <label class="col-md-2 control-label">联系电话</label>
                    <div class="col-md-4">
                      <input class="form-control wronginputPH" id="edit_phone" type="text" placeholder="">
                      <span id="EditphoneSpan" class="glyphicon form-control-feedback" aria-hidden="true"></span>
                    </div>
                  </div>
                  <div class="form-group has-feedback" id="EditpostcodeTrue">
                    <label class="col-md-2 control-label">邮政编码</label>
                    <div class="col-md-4">
                      <input class="form-control wronginputPH" id="edit_postcode" type="text" placeholder="">
                      <span id="EditpostcodeSpan" class="glyphicon form-control-feedback" aria-hidden="true"></span>
                    </div>
                  </div>
                </form>
              </div>

              <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal" id="closeModal">关闭</button>
                <button type="button" class="btn btn-primary" id="saveEdit">保存</button>
              </div>
            </div>
          </div>
        </div>







        <!-- 确定删除的模态框 -->
        <div class="modal fade" id="deleteModal">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                    aria-hidden="true">&times;</span></button>
              </div>
              <div class="modal-body">
                <h2 class="text-center">确定删除？</h2>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal" id="closeModal">取消</button>
                <button type="button" class="btn btn-primary" id="delete_sure">确定</button>
              </div>
            </div>
          </div>
        </div>




        <!-- 确定设置为默认地址的模态框 -->
        <div class="modal fade" id="setDefaultModal">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                    aria-hidden="true">&times;</span></button>
              </div>
              <div class="modal-body">
                <h2 class="text-center">确定设置为默认地址？</h2>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal" id="closeModal">取消</button>
                <button type="button" class="btn btn-primary" id="setDefault_sure">确定</button>
              </div>
            </div>
          </div>
        </div>
        <!-- 确定设置为默认地址的模态框 -->
        <div class="modal fade" id="setDefaultModal1">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                    aria-hidden="true">&times;</span></button>
              </div>
              <div class="modal-body">
                <h2 class="text-center">确定将地址设置为定位地址？</h2>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal" id="closeModal">取消</button>
                <button type="button" class="btn btn-primary" id="setDefault_sure1">确定</button>
              </div>
            </div>
          </div>
        </div>




        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
      </div>
    </div>
  </div>


  <!--页尾-->
  <div class="foot">
    <div class="container">
      <div class="row " style="margin-bottom: 20px;">
        <div class="col-md-4 col-xs-12" style="margin-bottom: 10px;">
          <div class="row">
            <div class="col-md-12 col-xs-4 center-block"><img class="img-responsive" style="width: 120px;height: 60px;"
                src="/pic/index/foot_logo.PNG" alt=""></div>
            <div class="col-md-12 col-xs-8 center-block">
              <span>手机：18569065625（微信同号）</span><br />
              <span>服务热线：400-7070-669</span><br />
              <span>地址：华南师范大学南海校区软件学院</span>
            </div>
          </div>
        </div>
        <div class="col-md-4 col-xs-12" style="margin-bottom: 10px;">
          <div class="row center-block">
            <div class="col-md-6 col-xs-6">
              <div class="row center-block"><img class="img-responsive" style="width: 100px;height: 100px;"
                  src="pic/index/foot1.png" alt=""></div>
              <div class="row center-block"><span style="font-size: 15px;color: white;">淘宝登录</span></div>
            </div>
            <div class="col-md-6 col-xs-6">
              <div class="row center-block"><img class="img-responsive" style="width: 100px;height: 100px;"
                  src="pic/index/foot2.png" alt=""></div>
              <div class="row center-block"><span style="font-size: 15px;color: white;">京东服务号</span></div>
            </div>
          </div>
        </div>
        <div class="col-md-4 col-xs-12" style="margin-bottom: 10px;">
          <div class="row">
            <div class="col-md-12 col-xs-6 center-block" style="margin-bottom: 10px;"><span><a
                  href="#">联系我们</a>&nbsp;&nbsp;|&nbsp;&nbsp;<a href="#">合作招商</a>&nbsp;&nbsp;|&nbsp;&nbsp;<a
                  href="#">隐私政策</a>&nbsp;&nbsp;|&nbsp;&nbsp;<a href="#">销售联盟</a></span></div>
            <div class="col-md-12 col-xs-6">
              <div class="row center-block" style="margin-bottom: 10px;">
                <span>服务热线</span><br />
                <span style="font-size: 20px;color: white;">400-7070-669</span>
              </div>
              <div class="row center-block"><button class="btn btn-primary">在线咨询</button><br /></div>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-xs-12">
          <div class="text-center">XX©2013-2019 XX公司版权所有 粤ICP备08010314号-43 </div>
        </div>
      </div>
    </div>
  </div>


  <script src="js/jquery.min.js"></script>
  <script src="js/bootstrap.js"></script>
  <script src="js/offcanvas.js"></script>

  <script>
  
    window.onload = function () {
	var dizhi=decodeURI(location.href).split('=')[1];
	$('#dizhi').val(dizhi)
	$('#add_address').val(dizhi)
      if (window.sessionStorage) {
        if (sessionStorage.getItem("uid")) {
          // 获取登录后的用户信息
          $("#nickname").css("display", "")
          $("#personal").css("display", "")
          var nickname = sessionStorage.getItem("nickname")
          var html = nickname + $("#nickname").html()
          $("#nickname").html(html)

          $(".dropdown-menu").css("height", 160)
          var html2 = `
                  <li role="presentation">              
                    <span id="nickname2" role="menuitem" tabindex="-1" href=""  style="font-size: 13px; color: white;"></ span>            
                  </li>
                  <li role="presentation">
                    <a role="menuitem" tabindex="-1" href="#" style="font-size: 13px; color: white;" data-target="#myModal2" id="cart2">
                      <span class="glyphicon glyphicon-shopping-cart"></span>
                    </a>
                  </li>
                  <li role="presentation">
                    <a role="menuitem" tabindex="-1" href="#" style="font-size: 13px; color: white;">
                      <span class="glyphicon glyphicon-heart"></span>
                    </a>
                  </li>
                  <li role="presentation">              
                    <a role="menuitem" tabindex="-1" href="ego_shop_personal.html" style="font-size: 13px; color: white;">个人中心</ a>            
                  </li>
                  <li role="presentation">              
                    <a role="menuitem" tabindex="-1" href="ego_shop_address.html"  style="font-size: 13px; color: white;">地址管理</ a>            
                  </li>
                  <li role="presentation">              
                    <a id="logout2" role="menuitem" tabindex="-1" href="#"  style="font-size: 13px; color: white;">退出</a>            
                  </li>
                  `
          $(".dropdown-menu").html(html2)
          $("#nickname2").html(nickname)
        }
        else {
          $("#login").css("display", "")
          $("#regist").css("display", "")
        }
      }
      else
        alert("该浏览器不支持localStorage")

      $("#md_search").click(function () {
        var keyword = $("#md_keyword").val()
        $("#md_keyword").val("")
        location.href = "search.html?keyword=" + keyword
      })

      $("#cart1,#cart2").click(function () {
        if (sessionStorage.getItem("uid")) {
          // 获取登录后的用户信息
          location.href = "cart.html"
        }
        else {
          $("#myModal2").modal('show')
        }
      })

      //  加
      $("#logout,#logout2").click(function () {
        sessionStorage.removeItem("uid")
        sessionStorage.removeItem("nickname")
        alert("退出成功！")
        location.href = "index.html"
      })
    }
    $("#dingwei").click(function(){
  	  var di=$('#dizhi').val()
  	  $('#add_address').val(di)
    })
    $("#dingwei1").click(function(){
  	  var di=$('#dizhi').val()
  	  $('#edit_address').val(di)
    })
    
    
    let uid = window.sessionStorage.getItem('uid')
// 基本信息按钮被点击时
$('#ego_personal').click(function () {
  window.location.href = 'ego_shop_personal.html'
})
// 收货地址按钮被点击时
$('#ego_address').click(function () {
  window.location.href = 'ego_shop_address.html'
})

// 新增收货地址被点击时
$('#make_addModal').click(function () {
  $('#addressModal').modal()
})

// 添加收货地址的保存被点击时
$('#saveAddress').click(function () {
  let postcodeInput = $('#add_postcode').val()
  let phoneInput = $('#add_phone').val()
  let postcodeReg = /[1-9]\d{5}(?!\d)/ // 邮政编码的正则表达式
  let phoneReg = /^((13[0-9])|(14[5|7])|(15([0-3]|[5-9]))|(18[0,5-9]))\d{8}$/ // 手机号正则表达式
  // 验证手机号的正确性

  let receiver = $('#add_receiver').val()
  let province = $('#add_province').val()
  let city = $('#add_city').val()
  let county = $('#add_county').val()
  let address = $('#add_address').val()
  let phone = $('#add_phone').val()
  let postcode = $('#add_postcode').val()

  if (!phoneReg.test(phoneInput)) {
    $('#add_phone').val('')
    $('#add_phone').attr('placeholder', '格式有误')
    $('#phoneTrue').addClass('has-error')
    $('#phoneSpan').addClass('glyphicon-remove')
    return
  }
  // 验证postcode的正确性
  if (!postcodeReg.test(postcodeInput)) {
    $('#add_postcode').val('')
    $('#add_postcode').attr('placeholder', '格式有误')
    $('#postcodeTrue').addClass('has-error')
    $('#postcodeSpan').addClass('glyphicon-remove')
    return
  }

  $.ajax({
	    type: 'POST',
	    url: 'http://localhost:8080/EGO/addAddress',
	    data:JSON.stringify({uid:uid,receiver:receiver,province:province,city:city,county:county,address:address,phone:phone,postcode:postcode}),
	    dataType: 'json',
	    contentType:"application/json; charset=utf-8",
	    success: function (data, msg, xhr) {
	      if (data.code == "200") {
	        let aid = data.aid
	        let newInsert = `<div class="row">
	                                  <div class="col-md-9 myaddress" id="whole_${aid}">
	                                    <div class="myinner">
	                                      <div class="row">
	                                        <div class="col-xs-12 col-md-2 col-md-pull-1 myright">收货人:</div>
	                                        <div class="col-xs-12 col-md-6 col-md-pull-1 myleft" id="receiver_${aid}">${receiver}</div>
	                                      </div>
	                                      <div class="row">
	                                        <div class="col-xs-12 col-md-2 col-md-pull-1 myright">所在地区:</div>
	                                        <div class="col-xs-12 col-md-6 col-md-pull-1 myleft" id="prefecture_${aid}">${province}${city}${county}</div>
	                                      </div>
	                                      <div class="row">  
	                                        <div class="col-xs-12 col-md-2 col-md-pull-1 myright">地址:</div>
	                                        <div class="col-xs-12 col-md-6 col-md-pull-1 myleft" id="address_${aid}">${address}</div>
	                                      </div>  
	                                      <div class="row">  
	                                        <div class="col-xs-12 col-md-2 col-md-pull-1 myright">手机:</div>  
	                                        <div class="col-xs-12 col-md-6 col-md-pull-1 myleft" id="phone_${aid}">${phone}</div>
	                                      </div>  
	                                      <div class="row">
	                                        <div class="col-xs-12 col-md-2 col-md-pull-1 myright">邮政编码:</div>
	                                        <div class="col-xs-12 col-md-5 col-md-pull-1 myleft" id="postcode_${aid}">${postcode}</div>
	                                        <div class=" col-md-5">
	                                          <button class="btn-mine-edit" onclick="myEdit(${aid})">编辑</button>
	                                          <button class="btn-mine-delete" onclick="myDelete(${aid})">删除</button>
	                                          <button class="btn-mine-defaultaddress" onclick="mySet(${aid})">设置为默认地址</button>
	                                      	  <button class="btn-mine-defaultaddress" onclick="mySet1(${aid})">设置为定位地址</button>
	                                        </div>
	                                      </div>
	                                    </div>
	                                  </div>
	                                </div>`
	        $('#waitingInsert').append(newInsert)
	      }
	    },
	    error: function (xhr, err) {
	      console.log('异步请求地址API失败：')
	      console.log(xhr)
	      console.log(err)
	    }
	  })

  // 关闭模态框
  $('#addressModal').modal('hide')
})

// 邮政编码框被选中时
$('#add_postcode').focus(function () {
  $('#add_postcode').attr('placeholder', '')
  $('#postcodeTrue').removeClass('has-error')
  $('#postcodeSpan').removeClass('glyphicon-remove')
})

// 联系电话框被选中时
$('#add_phone').focus(function () {
  $('#add_phone').attr('placeholder', '')
  $('#phoneTrue').removeClass('has-error')
  $('#phoneSpan').removeClass('glyphicon-remove')
})

// 编辑邮政编码框被选中时
$('#edit_postcode').focus(function () {
  $('#edit_postcode').attr('placeholder', '')
  $('#EditpostcodeTrue').removeClass('has-error')
  $('#EditpostcodeSpan').removeClass('glyphicon-remove')
})

// 编辑联系电话框被选中时
$('#edit_phone').focus(function () {
  $('#edit_phone').attr('placeholder', '')
  $('#EditphoneTrue').removeClass('has-error')
  $('#EditphoneSpan').removeClass('glyphicon-remove')
})


// 获取用户的所有地址
$.ajax({
  method: 'POST',
  url: 'http://localhost:8080/EGO/showAddress',
  data:JSON.stringify({uid:uid}),
  dataType: 'json',
  contentType:"application/json; charset=utf-8",
  success: function (data, msg, xhr) {
    console.log('异步请求管理地址API成功', data)
    if (data.code == "200" || data.code == "201") {
      let count = data.allAddress.length
      for (let i = 0; i < count; i++) {
        let aid = data.allAddress[i].aid
        let insertData = `<div class="row">
                                  <div class="col-md-9 myaddress" id="whole_${aid}">
                                    <div class="myinner">
                                      <div class="row">
                                        <div class="col-xs-12 col-md-2 myfontweight">收货人:</div>
                                        <div class="col-md-6 col-md-pull-1 myleft" id="receiver_${aid}">${data.allAddress[i].receiver}</div>
                                      </div>
                                      <div class="row">
                                        <div class="col-md-2 myfontweight">所在地区:</div>
                                        <div class="col-md-6 col-md-pull-1 myleft" id="prefecture_${aid}">${data.allAddress[i].province}${data.allAddress[i].city}${data.allAddress[i].county}</div>
                                      </div>
                                      <div class="row">  
                                        <div class="col-md-2 myfontweight">地址:</div>
                                        <div class="col-md-6 col-md-pull-1 myleft" id="address_${aid}">${data.allAddress[i].address}</div>
                                      </div>  
                                      <div class="row">  
                                        <div class="col-md-2  myfontweight">手机:</div>  
                                        <div class="col-md-6 col-md-pull-1 myleft" id="phone_${aid}">${data.allAddress[i].phone}</div>
                                      </div>  
                                      <div class="row">
                                        <div class="col-md-2  myfontweight">邮政编码:</div>
                                        <div class="col-md-5 col-md-pull-1 myleft" id="postcode_${aid}">${data.allAddress[i].postcode}</div>
                                        <div class="col-md-5">
                                          <button class="btn-mine-edit" onclick="myEdit(${data.allAddress[i].aid})">编辑</button>
                                          <button class="btn-mine-delete" onclick="myDelete(${data.allAddress[i].aid})">删除</button>
                                          <button class="btn-mine-defaultaddress" onclick="mySet(${data.allAddress[i].aid})">设置为默认地址</button>
                                          <button class="btn-mine-defaultaddress" onclick="mySet1(${data.allAddress[i].aid})">设置为定位地址</button>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                </div>`
        $('#waitingInsert').append(insertData)
        if(data.code == "200"){
          let defaultaid = data.defaultaid
          if(aid == defaultaid){
            $(`#whole_${aid}`).addClass('defaultADbg')
          }
        }
      }
    }
    else{}
  },
  error: function (xhr, err) {
    console.log('异步请求地址API失败：')
    console.log(xhr)
    console.log(err)
  }
})

// 直接写function是为了响应直接onclick，绕过选取不到id或要锁定很多id的麻烦,同时还要往func里面传参数
// 编辑收货地址(这个是用来显示的)
function myEdit(aid) {
  $.ajax({
    method: 'POST',
    url: 'http://localhost:8080/EGO/showeditAddress',
    data:JSON.stringify({aid:aid}),
    dataType: 'json',
    contentType:"application/json; charset=utf-8",
    success: function (data, msg, xhr) {
      console.log('异步请求模态框数据成功', data)
      if (data.code == "200") {
        let receiver = data.result.receiver
        let province = data.result.province
        let city = data.result.city
        let county = data.result.county
        let address = data.result.address
        let phone = data.result.phone
        let postcode = data.result.postcode
        $('#edit_receiver').val(receiver)
        $('#edit_province').val(province)
        $('#edit_city').val(city)
        $('#edit_county').val(county)
        $('#edit_address').val(address)
        $('#edit_phone').val(phone)
        $('#edit_postcode').val(postcode)
        $('#saveEdit').attr('onclick', `saveEdit(${aid})`)
      }
    },
    error: function (xhr, err) {
      console.log('异步请求地址API失败：')
      console.log(xhr)
      console.log(err)
    }
  })
  $('#editModal').modal()
}

// 编辑收货地址(这个是用来修改的)
function saveEdit(aid) {
  let receiver = $('#edit_receiver').val()
  let province = $('#edit_province').val()
  let city = $('#edit_city').val()
  let county = $('#edit_county').val()
  let address = $('#edit_address').val()
  let phone = $('#edit_phone').val()
  let postcode = $('#edit_postcode').val()

  let postcodeReg = /[1-9]\d{5}(?!\d)/ // 邮政编码的正则表达式
  let phoneReg = /^((13[0-9])|(14[5|7])|(15([0-3]|[5-9]))|(18[0,5-9]))\d{8}$/ // 手机号正则表达式


  // 验证手机号的正确性
  if (!phoneReg.test(phone)) {
    $('#edit_phone').val('')
    $('#edit_phone').attr('placeholder', '格式有误')
    $('#EditphoneTrue').addClass('has-error')
    $('#EditphoneSpan').addClass('glyphicon-remove')
    return
  }
  // 验证postcode的正确性
  if (!postcodeReg.test(postcode)) {
    $('#edit_postcode').val('')
    $('#edit_postcode').attr('placeholder', '格式有误')
    $('#EditpostcodeTrue').addClass('has-error')
    $('#EditpostcodeSpan').addClass('glyphicon-remove')
    return
  }

  $.ajax({
    method: 'POST',
    url: 'http://localhost:8080/EGO/editAddress',
    data: JSON.stringify({aid:aid,receiver:receiver,province:province,city:city,county:county,address:address,phone:phone,postcode:postcode}),
    dataType: 'json',
    contentType:"application/json; charset=utf-8",
    success: function (data, msg, xhr) {
      console.log('异步请求模态框数据成功', data)
      if (data.code == "200") {
        console.log("编辑成功")
        let prefecture = `${province}${city}${county}`
        let receiverId = `receiver_${aid}`
        let prefectureId = `prefecture_${aid}`
        let addressId = `address_${aid}`
        let phoneId = `phone_${aid}`
        let postcodeId = `postcode_${aid}`
        console.log(receiverId)
        console.log(receiver)
        $(`#${receiverId}`).html(receiver)
        $(`#${prefectureId}`).html(prefecture)
        $(`#${addressId}`).html(address)
        $(`#${phoneId}`).html(phone)
        $(`#${postcodeId}`).html(postcode)
        $('#editModal').modal('hide')
      }

    },
    error: function (xhr, err) {
      console.log('异步请求地址API失败：')
      console.log(xhr)
      console.log(err)
    }
  })
}

// 删除收货地址
function myDelete(aid) {
  window.sessionStorage.setItem('Delaid',aid)
  $('#deleteModal').modal()
}

$('#delete_sure').click(function () {
  let aid = window.sessionStorage.getItem('Delaid')
  $.ajax({
    method: 'POST',
    url: 'http://localhost:8080/EGO/deleteAddress',
    data:JSON.stringify({aid:aid}),
    dataType: 'json',
    contentType:"application/json; charset=utf-8",
    success: function (data, msg, xhr) {
      console.log('异步请求模态框数据成功', data)
      if (data.code == "200") {
        console.log("删除成功")
        $(`#whole_${aid}`).hide()
        $('#deleteModal').modal('hide')
      }
    },
    error: function (xhr, err) {
      console.log('异步请求地址API失败：')
      console.log(xhr)
      console.log(err)
    }
  })
})


// 设置默认地址
function mySet(aid) {
  window.sessionStorage.setItem('Setaid', aid)
  $('#setDefaultModal').modal()
}
//设置为定位地址
function mySet1(aid){
	window.sessionStorage.setItem('Setaid', aid)
	$('#setDefaultModal1').modal()
}

$('#setDefault_sure').click(function () {
  let aid = window.sessionStorage.getItem('Setaid')
  let uid = window.sessionStorage.getItem('uid')
  $.ajax({
    method: 'POST',
    url: 'http://localhost:8080/EGO/setDefaultAddress',
    data:JSON.stringify({aid:aid,uid:uid}),
    dataType: 'json',
    contentType:"application/json; charset=utf-8",
    success: function (data, msg, xhr) {
      console.log('异步请求设置默认地址成功', data)
      if (data.code == "200") {
        console.log("设置成功")
        $(`#whole_${aid}`).addClass('defaultADbg')
        for(let i = 0; i < data.NotDefaultaid.length; i++){    	
          $(`#whole_${data.NotDefaultaid[i].aid}`).removeClass('defaultADbg')
        }
      }
      $('#setDefaultModal').modal('hide')
    },
    error: function (xhr, err) {
      console.log('异步请求设置默认地址失败：')
      console.log(xhr)
      console.log(err)
    }
  })
})

$('#setDefault_sure1').click(function () {
  let aid = window.sessionStorage.getItem('Setaid')
  let uid = window.sessionStorage.getItem('uid')
  let dizhi=$('#dizhi').val()
  $.ajax({
    method: 'POST',
    url: 'http://localhost:8080/EGO/setDefaultAddress1',
    data:JSON.stringify({aid:aid,address:dizhi}),
    dataType: 'json',
    contentType:"application/json; charset=utf-8",
    success: function (data, msg, xhr) {
      console.log('异步请求设置为定位地址成功', data)
      if (data.code == "200") {
        console.log("设置成功")
        
      }
      $('#setDefaultModal1').modal('hide')
      location.reload();
    },
    error: function (xhr, err) {
      console.log('异步请求设置默认地址失败：')
      console.log(xhr)
      console.log(err)
    }
  })
})




  </script>

</body>

</html>